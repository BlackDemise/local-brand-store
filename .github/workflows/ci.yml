#name: Backend CI
#
#on:
#  push:
#    branches: [ main, develop ]
#    paths:
#      - 'backend/**'
#      - '.github/workflows/ci.yml'
#  pull_request:
#    branches: [ main, develop ]
#    paths:
#      - 'backend/**'
#
#jobs:
#  test:
#    runs-on: ubuntu-latest
#
#    services:
#      postgres:
#        image: postgres:15
#        env:
#          POSTGRES_DB: lbs_test
#          POSTGRES_USER: postgres
#          POSTGRES_PASSWORD: postgres
#        options: >-
#          --health-cmd pg_isready
#          --health-interval 10s
#          --health-timeout 5s
#          --health-retries 5
#        ports:
#          - 5432:5432
#
#      redis:
#        image: redis:7-alpine
#        options: >-
#          --health-cmd "redis-cli ping"
#          --health-interval 10s
#          --health-timeout 5s
#          --health-retries 5
#        ports:
#          - 6379:6379
#
#    steps:
#      - uses: actions/checkout@v4
#
#      - name: Set up JDK 17
#        uses: actions/setup-java@v4
#        with:
#          java-version: '17'
#          distribution: 'temurin'
#          cache: 'maven'
#
#      - name: Build with Maven
#        working-directory: ./backend
#        run: ./mvnw clean install -B
#        env:
#          DATABASE_URL: jdbc:postgresql://localhost:5432/lbs_test
#          DATABASE_USERNAME: postgres
#          DATABASE_PASSWORD: postgres
#          SPRING_DATA_REDIS_HOST: localhost
#          JWT_SECRET_KEY: ${{ secrets.JWT_SECRET_KEY_TEST }}
#
#      - name: Run Tests
#        working-directory: ./backend
#        run: ./mvnw test -B
#        env:
#          DATABASE_URL: jdbc:postgresql://localhost:5432/lbs_test
#          DATABASE_USERNAME: postgres
#          DATABASE_PASSWORD: postgres
#          SPRING_DATA_REDIS_HOST: localhost
#          JWT_SECRET_KEY: ${{ secrets.JWT_SECRET_KEY_TEST }}
#
#      - name: Upload Test Results
#        if: always()
#        uses: actions/upload-artifact@v4
#        with:
#          name: test-results
#          path: backend/target/surefire-reports/